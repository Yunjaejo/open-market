generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement()) @map("id")
  email     String   @unique @map("email")
  pwd       String   @map("pwd")
  name      String   @map("name")
  phone     String   @unique @map("phone")
  nickname  String   @unique @map("nickname")
  address   String   @map("address")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  isDeleted Boolean  @default(false) @map("is_deleted")
  type      UserType @map("type")

  items        Item[]
  cart         Cart[]
  order        Order[]
  review       Review[]
  refreshToken RefreshToken?

  @@index([email])
  @@index([nickname])
  @@index([phone])
  @@map("users")
}

enum UserType {
  CUSTOMER
  SELLER
}

model RefreshToken {
  id        Int      @id @default(autoincrement()) @map("id")
  token     String   @unique @map("token")
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")
  userId    Int      @unique @map("user_id")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("refresh_tokens")
}

model Item {
  id          Int      @id @default(autoincrement()) @map("id")
  name        String   @map("name")
  price       Int      @map("price")
  quantity    Int      @map("quantity")
  imageUrl    String?  @map("image_url")
  info        String   @map("info")
  reviewCount Int      @map("review_count")
  category    Category @map("category")
  nickname    String   @map("nickname")
  userId      Int      @map("user_id")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  orderItem OrderItem[]
  Cart      Cart[]

  @@index([userId])
  @@map("items")
}

enum Category {
  ELECTRONICS
  FASHION
  FOOD
  OTHER
}

model Cart {
  id        Int      @id @default(autoincrement()) @map("id")
  itemId    Int      @map("item_id")
  quantity  Int      @map("quantity")
  createdAt DateTime @default(now()) @map("created_at")
  userId    Int      @map("user_id")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  item Item @relation(fields: [itemId], references: [id], onDelete: Cascade)

  @@map("carts")
}

model Order {
  id         Int         @id @default(autoincrement()) @map("id")
  totalPrice Int         @map("total_price")
  status     OrderStatus @default(PENDING) @map("status")
  createdAt  DateTime    @default(now()) @map("created_at")
  userId     Int         @map("user_id")

  user User @relation(fields: [userId], references: [id])

  orderItem OrderItem[]

  @@map("orders")
}

enum OrderStatus {
  PENDING
  COMPLETED
  CANCELLED
}

model OrderItem {
  id       Int @id @default(autoincrement()) @map("id")
  orderId  Int @map("order_id")
  itemId   Int @map("item_id")
  price    Int @map("price")
  quantity Int @map("quantity")

  order Order @relation(fields: [orderId], references: [id])
  item  Item  @relation(fields: [itemId], references: [id])

  @@map("order_items")
}

model Review {
  id        Int      @id @default(autoincrement()) @map("id")
  itemId    Int      @map("item_id")
  nickname  String   @map("nickname")
  rating    Int      @map("rating")
  content   String?  @map("content")
  createdAt DateTime @default(now()) @map("created_at")
  isDeleted Boolean? @map("is_deleted")
  userId    Int      @map("user_id")

  user User @relation(fields: [userId], references: [id])

  reviewComment ReviewComment[]

  @@map("reviews")
}

model ReviewComment {
  id        Int      @id @default(autoincrement()) @map("id")
  nickname  String   @map("nickname")
  content   String   @map("content")
  type      UserType @map("type")
  createdAt DateTime @default(now()) @map("created_at")
  reviewId  Int      @map("review_id")

  review Review @relation(fields: [reviewId], references: [id], onDelete: Cascade)

  @@map("review_comments")
}
